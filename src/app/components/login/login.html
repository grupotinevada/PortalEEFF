<div class="container d-flex justify-content-center align-items-center min-vh-100">
  <div class="card shadow-lg border-0" style="width: 25rem;">
    <div class="card-body p-4 p-md-5">

      <!-- Usamos @switch para mostrar una de las tres secciones -->
      @switch (currentSection) {

        <!-- ============================================= -->
        <!-- SECCIÓN 1: INICIO DE SESIÓN CON MICROSOFT (VISIBLE POR DEFECTO) -->
        <!-- ============================================= -->
        @case ('microsoft') {
          <div class="text-center">
            <img src="/logo.png" alt="Logo Corporativo" class="img-fluid mb-4">
            <h5 class="card-title mb-3">Acceso al Portal</h5>
            <p class="text-muted mb-4">Inicia sesión de forma segura con tu cuenta corporativa.</p>
            
            <!-- Botón de Microsoft -->
            <a href="http://localhost:3003/api/auth/microsoft" class="btn btn-primary btn-lg w-100 shadow-sm">
              <i class="bi bi-microsoft me-2"></i> Iniciar sesión con Microsoft
            </a>

            <div class="mt-4">
              <button (click)="showFormLogin()" class="btn btn-link btn-sm text-muted">
                Usar credenciales de portal
              </button>
            </div>
          </div>
        }

        <!-- ============================================= -->
        <!-- SECCIÓN 2: FORMULARIO DE LOGIN (OCULTO) -->
        <!-- ============================================= -->
        @case ('form') {
          <div class="text-center mb-4">
             <img src="/logo.png" alt="Logo Corporativo" class="img-fluid">
          </div>
          <p class="card-text text-center text-muted mb-4">Ingresa tus credenciales para acceder.</p>
          
          <form [formGroup]="form" (ngSubmit)="onSubmit()">
            <div class="input-group mb-3">
              <span class="input-group-text bg-light border-end-0"><i class="bi bi-envelope-fill"></i></span>
              <input type="email" class="form-control form-control-lg bg-light border-start-0" id="email" formControlName="email" placeholder="Correo electrónico">
            </div>
            <div class="input-group mb-4">
              <span class="input-group-text bg-light border-end-0"><i class="bi bi-shield-lock-fill"></i></span>
              <input type="password" class="form-control form-control-lg bg-light border-start-0" id="password" formControlName="password" placeholder="Contraseña">
            </div>
            
            <button type="submit" class="btn btn-outline-success btn-lg w-100 mb-3 shadow">
              Iniciar sesión
            </button>

            @if(errorMsg){
              <div class="alert alert-danger mt-3 mb-0 text-center">
                {{ errorMsg }}
              </div>
            }
          </form>

          <div class="text-center mt-3">
             <button (click)="showMicrosoftLogin()" class="btn btn-link btn-sm text-muted">
               &larr; Volver al inicio de sesión corporativo
             </button>
          </div>
        }

        <!-- ============================================= -->
        <!-- SECCIÓN 3: NO AUTORIZADO (OCULTO) -->
        <!-- ============================================= -->
        @case ('unauthorized') {
          <div class="text-center">
            <i class="bi bi-shield-exclamation text-danger" style="font-size: 4rem;"></i>
            <h4 class="mt-3">Acceso Denegado</h4>
            <p class="text-muted mt-3">
              Tu cuenta de Microsoft ha sido autenticada, pero no tienes los permisos necesarios para acceder a esta aplicación.
            </p>
            <p class="text-muted small">
              Por favor, contacta al administrador del sistema si crees que esto es un error.
            </p>
            <button (click)="showMicrosoftLogin()" class="btn btn-secondary mt-3">
              <i class="bi bi-arrow-left me-2"></i> Volver al Inicio
            </button>
          </div>
        }
      }

      <!-- Footer común para todas las secciones -->
      <div class="text-center mt-4 border-top pt-3">
        <small class="text-muted">© 2025 Holding Nevada.</small>
      </div>

    </div>
  </div>
</div>

<app-spinner [showSpinner]="showSpinner"></app-spinner>
